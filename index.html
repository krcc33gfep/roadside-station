<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>道の駅ビューワー</title>

<link href="https://fonts.googleapis.com/css2?family=M+PLUS+1+Code:wght@400;500&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'M PLUS 1 Code', monospace;
  background: #b9dcb3;
}

header {
  padding: 12px;
  background: #b9dcb3;
}

.search-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.search-box {
  width: 66%;
  padding: 14px;
  border-radius: 20px;
  border: none;
  font-size: 18px;
}

.result-count {
  flex: 1;
  text-align: right;
  font-size: 22px;
}

.button-row {
  display: flex;
  gap: 12px;
  margin-top: 12px;
}

.btn {
  flex: 1;
  padding: 14px 0;
  font-size: 22px;
  border: none;
  border-radius: 16px;
  background: #9fcf95;
}

.btn.active {
  background: #6fb15e;
  color: #fff;
}

.counts {
  margin-top: 8px;
  font-size: 20px;
  text-align: right;
}

main {
  background: #fff;
}
</style>
</head>

<body>

<header>
  <div class="search-row">
    <input id="searchInput" class="search-box" placeholder="検索（名称・住所）">
    <div id="resultCount" class="result-count">0件</div>
  </div>

  <div class="button-row">
    <button id="toggleBtn" class="btn">全部</button>
    <button id="saveBtn" class="btn">保存</button>
  </div>

  <div class="counts">
    訪問：<span id="visitCount">0</span><br>
    切符：<span id="ticketCount">0</span>
  </div>
</header>

<main id="list"></main>

<script>
/* ===== 既存データ・保存処理は変更なし想定 ===== */
let data = []; // 既存データが入る前提
let mode = "visited_latest"; // 初期：訪問済み＋最終訪問日新しい順

function updateView() {
  let filtered = [...data];

  if (mode !== "all") {
    filtered = filtered.filter(d => d.visits && d.visits.length);
    filtered.sort((a, b) => {
      const da = new Date(a.visits[a.visits.length - 1]);
      const db = new Date(b.visits[b.visits.length - 1]);
      return db - da;
    });
  }

  const keyword = searchInput.value.trim();
  if (keyword) {
    filtered = filtered.filter(d =>
      d.name.includes(keyword) || d.address.includes(keyword)
    );
  }

  resultCount.textContent = filtered.length + "件";
  renderList(filtered);
}

function renderList(list) {
  const area = document.getElementById("list");
  area.innerHTML = "";
  list.forEach(d => {
    const div = document.createElement("div");
    div.textContent = d.name;
    area.appendChild(div);
  });
}

toggleBtn.addEventListener("click", () => {
  if (mode === "visited_latest") {
    mode = "all";
    toggleBtn.classList.add("active");
  } else {
    mode = "visited_latest";
    toggleBtn.classList.remove("active");
  }
  updateView();
});

searchInput.addEventListener("input", updateView);

/* 保存ボタン処理は既存コードそのまま */
saveBtn.addEventListener("click", () => {
  // 既存保存処理
});

/* 初期描画 */
updateView();
</script>

</body>
</html>
